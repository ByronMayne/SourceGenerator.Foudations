<?xml version="1.0" encoding="utf-8" ?>
<Project>
	<Target Name="SGF_EmbedDependencies" AfterTargets="ResolveAssemblyReferences">
		<PropertyGroup>
			<IsRoslynComponent>true</IsRoslynComponent>
			<IsInNugetPackage>false</IsInNugetPackage>
			<IsInNugetPackage Condition="Exists('$(MSBuildThisFileDirectory)..\.nupkg.metadata')">true</IsInNugetPackage>
			<SGF_NuGetEnvironmentsDir>$(MSBuildThisFileDirectory)..\environments\</SGF_NuGetEnvironmentsDir>
			<SGF_NetGetNetStandardDir>$(MSBuildThisFileDirectory)..\lib\netstandard2.0\</SGF_NetGetNetStandardDir>
			<SGF_IsMainAssembly>false</SGF_IsMainAssembly>
			<SGF_IsMainAssembly Condition="'$(MSBuildProjectName)' == 'SourceGenerator.Foundations'">True</SGF_IsMainAssembly>
		</PropertyGroup>
		
		<!-- Shared References -->
		<ItemGroup>
			<PackageReference Include="Serilog" Version="2.12.0" />
		</ItemGroup>
		
		<!-- When running as NuGet package, copy all dlls in the lib folder -->
		<ItemGroup Condition="$(IsInNugetPackage)">
			<SGF_EmbeddedAssembly Include="$(SGF_NetGetNetStandardDir)*.*"/>
			<SGF_EmbeddedAssembly Include="$(SGF_NuGetEnvironmentsDir)*.*"/>
		</ItemGroup>

		<!-- Embedded Assemblies -->
		<ItemGroup>
			<!-- Include all the referenced assemblies -->
			<SGF_EmbeddedAssembly Include="@(ReferencePath->'%(RootDir)%(Directory)%(Filename)%(Extension)')"/>
			<!-- Assemblies To Ingore -->
			<SGF_EmbeddedAssembly Remove="@(SGF_EmbeddedAssembly->'%(RootDir)%(Directory)System.*.dll')"/>
			<SGF_EmbeddedAssembly Remove="@(SGF_EmbeddedAssembly->'%(RootDir)%(Directory)System.dll')"/>
			<!--<SGF_EmbeddedAssembly Remove="@(SGF_EmbeddedAssembly->'%(RootDir)%(Directory)Microsoft.*.dll')"/>-->
			<SGF_EmbeddedAssembly Remove="@(SGF_EmbeddedAssembly->'%(RootDir)%(Directory)mscorlib.dll')"/>
			<!-- Only the foundations library should have embedded plugins -->
			<SGF_EmbeddedAssembly Remove="@(SGF_EmbeddedAssembly->'%(RootDir)%(Directory)SourceGenerator.Foundations.*.dll')" Condition="!$(SGF_IsMainAssembly)"/>
			<!-- Embed them as resources -->
			<EmbeddedResource Include="@(SGF_EmbeddedAssembly)">
				<LogicalName>SGF.Assembly::%(FileName)%(Extension)</LogicalName>
			</EmbeddedResource>
		</ItemGroup>
		<!-- Embeded Scripts -->
		<ItemGroup>
			<EmbeddedResource Include="@(SGF_EmbeddedScript)">
				<LogicalName>SGF.Script::%(RecursiveDir)%(FileName)%(Extension)</LogicalName>
			</EmbeddedResource>
		</ItemGroup>
		
	</Target>
</Project>